{% extends "core/base.html" %}
{% block title %}Profil de {{ profile.user.get_full_name }} - Benin Match{% endblock %}

{% block content %}
<main class="min-h-screen pt-20 pb-10 relative">
    <!-- Background Image de couverture -->
    <div class="w-full h-48 md:h-64 bg-gradient-to-r from-primary to-secondary relative">
        <!-- Image de couverture (optionnel) -->
        {% if profile.images.filter(is_cover=True).first %}
            <img src="{{ profile.images.filter(is_cover=True).first.image.url }}" class="w-full h-full object-cover opacity-50">
        {% endif %}
    </div>

    <!-- Carte Glassmorphism -->
    <div class="container mx-auto px-4 -mt-16 md:-mt-24 relative z-10">
        <div class="bg-base-200/50 backdrop-blur-2xl border border-white/10 rounded-[2.5rem] shadow-2xl p-6 md:p-10 flex flex-col md:flex-row gap-8">
            
            <!-- 1. Sidebar Photo & Stats -->
            <div class="md:w-1/3 flex flex-col items-center text-center space-y-6">
                
                <!-- Avatar -->
                <div class="relative -mt-20">
                    <div class="w-40 h-40 rounded-full border-4 border-base-100 shadow-xl overflow-hidden bg-black/50">
                        {% if profile.user.avatar %}
                            <img src="{{ profile.user.avatar.url }}" class="w-full h-full object-cover">
                        {% else %}
                            <img src="https://ui-avatars.com/api/?name={{ profile.user.email }}&background=f97316&color=fff" class="w-full h-full object-cover">
                        {% endif %}
                    </div>
                    <!-- Badge Diaspora -->
                    {% if profile.is_diaspora %}
                        <div class="absolute bottom-2 right-2 bg-secondary text-white text-xs font-bold px-2 py-1 rounded-full shadow-lg">
                            DIASPORA
                        </div>
                    {% endif %}
                </div>

                <div>
                    <h1 class="text-2xl font-black text-base-content">{{ profile.user.get_full_name }}</h1>
                    <p class="text-primary font-medium">{{ profile.age }} ans • {{ profile.city }}</p>
                </div>

                <!-- Stats Mini -->
                <div class="flex justify-center gap-4 text-sm font-bold text-base-content/60 w-full">
                    <div class="flex flex-col">
                        <span class="text-lg text-primary">5</span>
                        <span>Photos</span>
                    </div>
                    <div class="w-px bg-base-content/10 h-10"></div>
                    <div class="flex flex-col">
                        <span class="text-lg text-secondary">92%</span>
                        <span>Compatibilité</span>
                    </div>
                </div>

                <!-- Actions -->
                {% if user.is_authenticated %}
                    <a href="{% url 'messaging:start_chat' profile.id %}" class="btn btn-primary w-full rounded-full shadow-lg shadow-primary/30">
                        Envoyer un message
                    </a>
                    <button class="btn btn-outline w-full rounded-full mt-2 text-error border-error/20 hover:bg-error/5 hover:border-error">
                        Bloquer
                    </button>
                {% else %}
                    <a href="{% url 'users:register' %}" class="btn btn-primary w-full rounded-full shadow-lg">
                        S'inscrire pour contacter
                    </a>
                {% endif %}

            </div>

            <!-- 2. Contenu Principal -->
            <div class="md:w-2/3 space-y-8">
                
                <!-- Bio -->
                <div>
                    <h3 class="text-xl font-black text-base-content mb-2 border-l-4 border-primary pl-3">À propos de moi</h3>
                    <p class="text-base-content/70 leading-relaxed">
                        {{ profile.bio|default:"Je n'ai pas encore rempli ma bio..." }}
                    </p>
                </div>

                <!-- Infos -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-base-100/50 p-4 rounded-2xl border border-white/5">
                        <span class="text-xs uppercase tracking-widest text-base-content/50">Relation</span>
                        <div class="font-bold text-base-content capitalize mt-1">{{ profile.get_relationship_goal_display }}</div>
                    </div>
                    <div class="bg-base-100/50 p-4 rounded-2xl border border-white/5">
                        <span class="text-xs uppercase tracking-widest text-base-content/50">Ville</span>
                        <div class="font-bold text-base-content mt-1">{{ profile.city }}</div>
                    </div>
                </div>

                <!-- Galerie Photos -->
                {% if profile_images.count > 0 %}
                <div>
                    <h3 class="text-xl font-black text-base-content mb-4">Galerie</h3>
                    <div class="grid grid-cols-3 gap-4">
                        {% for img in profile_images %}
                            <img src="{{ img.image.url }}" class="rounded-xl object-cover h-32 w-full hover:scale-105 transition-transform">
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

            </div>
        </div>
    </div>
</main>
{% endblock %}