<!-- apps/messaging/partials/single_message.html -->
<div class="chat chat-{% if message.sender == user %}end{% else %}start{% endif %} message-fade-in" data-message-id="{{ message.id }}">
    
    <!-- Avatar -->
    <div class="chat-image avatar placeholder">
        <div class="w-8 h-8 rounded-full">
            {% if message.sender.avatar %}
                <img src="{{ message.sender.avatar.url }}" 
                     class="w-full h-full rounded-full object-cover"
                     alt="{{ message.sender.get_full_name }}">
            {% else %}
                <div class="w-full h-full rounded-full bg-primary/20 flex items-center justify-center text-xs font-bold text-primary">
                    {{ message.sender.first_name.0 }}
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Bulle de message -->
    <div class="chat-bubble {% if message.sender == user %}chat-bubble-primary{% else %}chat-bubble-secondary{% endif %} rounded-2xl shadow-lg">
        {% if message.image %}
            <img src="{{ message.image.url }}" 
                 class="message-image mb-2"
                 onclick="window.open(this.src, '_blank')"
                 alt="Image">
        {% endif %}
        {% if message.content %}
            <p class="text-base-content break-words">{{ message.content }}</p>
        {% endif %}
        <time class="text-[10px] opacity-50 block mt-1">
            {{ message.created_at|date:"H:i" }}
        </time>
    </div>

    <!-- Statut de lecture -->
    {% if message.sender == user %}
        <div class="chat-footer opacity-50 text-[10px] flex items-center gap-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            EnvoyÃ©
        </div>
    {% endif %}
</div>