# .github/workflows/deploy.yml
name: Pipeline CI Tests Auto (Benin Match)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  # Job 1 : Vérifier la qualité du code (CI)
  tests_integration:
    runs-on: ubuntu-latest
    
    # Configuration de l'environnement pour les tests
    env:
      # NOTE : Il faut créer un fichier config/settings/testing.py ou utiliser local.py
      DJANGO_SETTINGS_MODULE: "config.settings.local"
      SECRET_KEY: "cle-secrete-temporaire-pour-github-actions"
      DATABASE_URL: "sqlite:///tmp/db_test.sqlite3" # Pour les tests, SQLite est plus rapide
    
    steps:
      # 1. Récupérer le code
      - name: Checkout Code
        uses: actions/checkout@v4

      # 2. Installer Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # Version cible pour PythonAnywhere

      # 3. Installer Node.js (Pour compiler Tailwind et vérifier le build)
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      # 4. Installer les dépendances Python
      - name: Install Python Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 5. Installer les dépendances Node (Tailwind)
      - name: Install Node Dependencies
        run: npm install

      # 6. Vérifier que Tailwind compile sans erreur
      - name: Build Tailwind CSS
        run: npm run build
        

      # 7. Lancer les tests Django
      - name: Run Django Tests
        run: python manage.py test

      # 8. Vérifier la sécurité du code (Optionnel: flake8, black)
      # - name: Check Code Style
      #   run: pip install flake8 && flake8 .